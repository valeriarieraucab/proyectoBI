-- secuencias

CREATE SEQUENCE seq_sk_sede START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_sk_leyenda START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_sk_visitante START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_sk_tiempo START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_sk_cliente START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_sk_categoria START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_sk_evento START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_sk_tipo_stand START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_fact_evento_stand START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_fact_alquiler START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_fact_evento START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_fact_visita START WITH 1 INCREMENT BY 1;

-- dimensiones

CREATE TABLE dim_sede (
    seq_sk_sede numeric PRIMARY KEY,
    cod_pais numeric,
    nombre_pais varchar(100),
    nombre_ciudad varchar(100),
    cod_sede numeric,
    nombre_sede varchar(100)
);

CREATE TABLE dim_leyenda (
    seq_sk_leyenda numeric PRIMARY KEY,
    cod_leyenda numeric,
    nb_leyenda varchar(100)
);

CREATE TABLE dim_visitante (
    seq_sk_visitante numeric PRIMARY KEY,
    cod_visitante numeric,
    cedula numeric,
    nb_visiante varchar(100),
    sexo varchar(100),
    email varchar(100)
);

CREATE TABLE dim_tiempo (
    seq_sk_tiempo numeric PRIMARY KEY,
    cod_anio numeric,
    cod_trimestre numeric,
    desc_trimestre varchar(100),
    cod_mes numeric,
    desc_mes varchar(20),
    desc_mes_corta varchar(20),
    cod_semana numeric,
    cod_dia_anio numeric,
    cod_dia_mes numeric,
    cod_dia_semana numeric,
    desc_dia_semana varchar(20),
    fecha date
);

CREATE TABLE dim_cliente (
    seq_sk_cliente numeric PRIMARY KEY,
    cod_cliente numeric,
    ci_rif varchar(100),
    nb_cliente varchar(100),
    telefono varchar(100),
    direccion varchar(200),
    email varchar(100)
);

CREATE TABLE dim_categoria (
    seq_sk_categoria numeric PRIMARY KEY,
    cod_subcategoria numeric,
    nb_subcategoria varchar(100),
    cod_categoria numeric,
    nb_categoria varchar(100)
);

CREATE TABLE dim_evento (
    seq_sk_evento numeric PRIMARY KEY,
    cod_tipo_evento numeric,
    nb_tipo_evento varchar(100),
    cod_evento numeric,
    nb_evento varchar(100),
    descripcion varchar(200)
);

CREATE TABLE dim_tipo_stand (
    seq_sk_tipo_stand numeric PRIMARY KEY,
    cod_tipo_stand numeric,
    nb_tipo_stand varchar(100)
);

-- tablas de hecho

CREATE TABLE  fact_evento_stand(
    sk_evento numeric,
    sk_tipo_stand numeric,
    cantidad_estimada numeric,
    mt2 numeric(10,4),
    precio numeric(10,4),

    PRIMARY KEY (sk_evento, sk_tipo_stand),
    FOREIGN KEY (sk_evento) REFERENCES dim_evento(seq_sk_evento),
    FOREIGN KEY (sk_tipo_stand) REFERENCES dim_tipo_stand(seq_sk_tipo_stand)
);

CREATE TABLE fact_alquiler(
    sk_evento numeric,
    sk_cliente numeric,
    sk_fecha_alquiler numeric,
	sk_tipo_stand numeric,
    sk_categoria numeric,
    num_contrato numeric,
    num_stand numeric,
    mt2 numeric(10,4),
    monto numeric(10,4),
    cantidad numeric,

    PRIMARY KEY (sk_evento, sk_cliente, sk_fecha_alquiler, sk_tipo_stand, sk_categoria, num_contrato, num_stand),
    FOREIGN KEY (sk_evento) REFERENCES dim_evento(seq_sk_evento),
    FOREIGN KEY (sk_cliente) REFERENCES dim_cliente(seq_sk_cliente),
    FOREIGN KEY (sk_fecha_alquiler) REFERENCES dim_tiempo(seq_sk_tiempo),
    FOREIGN KEY (sk_tipo_stand) REFERENCES dim_tipo_stand(seq_sk_tipo_stand),
    FOREIGN KEY (sk_categoria) REFERENCES dim_categoria(seq_sk_categoria)
);

CREATE TABLE fact_evento (
    sk_evento numeric,
    sk_sede numeric,
    sk_fecha_evento numeric,
    cantidad_evento numeric,
    cantidad_estimada_visitantes numeric,
    meta_ingresos numeric(10,4),

    PRIMARY KEY (sk_evento, sk_sede, sk_fecha_evento),
    FOREIGN KEY (sk_evento) REFERENCES dim_evento(seq_sk_evento),
    FOREIGN KEY (sk_sede) REFERENCES dim_sede(seq_sk_sede),
    FOREIGN KEY (sk_fecha_evento) REFERENCES dim_tiempo(seq_sk_tiempo)
);

CREATE TABLE fact_visita (
    sk_evento numeric,
    sk_visitante numeric,
    sk_fecha_entrada numeric,
    sk_leyenda_estrellas numeric,
    num_entrada numeric,
    hora_entrada timestamp,
    cantidad_visitas numeric,
    calificacion_evento varchar(100),
    recomienda_amigo varchar(100),

    PRIMARY KEY (sk_evento, sk_visitante, sk_fecha_entrada, sk_leyenda_estrellas, num_entrada),

    FOREIGN KEY (sk_evento) REFERENCES dim_evento(seq_sk_evento),
    FOREIGN KEY (sk_visitante) REFERENCES dim_visitante(seq_sk_visitante),
    FOREIGN KEY (sk_leyenda_estrellas) REFERENCES dim_leyenda(seq_sk_leyenda),
    FOREIGN KEY (sk_fecha_entrada) REFERENCES dim_tiempo(seq_sk_tiempo)
);

--- inserts

ALTER TABLE dim_tiempo
ALTER COLUMN seq_sk_tiempo
SET DEFAULT nextval('seq_sk_tiempo');

INSERT INTO dim_tiempo (
    cod_anio,
    cod_trimestre,
    desc_trimestre,
    cod_mes,
    desc_mes,
    desc_mes_corta,
    cod_semana,
    cod_dia_anio,
    cod_dia_mes,
    cod_dia_semana,
    desc_dia_semana,
    fecha
) VALUES
-- ===== OCTUBRE 2025 =====
(2025, 4, 'Cuarto Trimestre', 10, 'Octubre', 'Oct', 41, 285, 12, 1, 'Domingo', '2025-10-12'),
(2025, 4, 'Cuarto Trimestre', 10, 'Octubre', 'Oct', 41, 286, 13, 2, 'Lunes',   '2025-10-13'),
(2025, 4, 'Cuarto Trimestre', 10, 'Octubre', 'Oct', 41, 287, 14, 3, 'Martes',  '2025-10-14'),
(2025, 4, 'Cuarto Trimestre', 10, 'Octubre', 'Oct', 41, 288, 15, 4, 'Miércoles','2025-10-15'),
(2025, 4, 'Cuarto Trimestre', 10, 'Octubre', 'Oct', 41, 289, 16, 5, 'Jueves',  '2025-10-16'),
(2025, 4, 'Cuarto Trimestre', 10, 'Octubre', 'Oct', 41, 290, 17, 6, 'Viernes', '2025-10-17'),
-- ===== NOVIEMBRE 2025 =====
(2025, 4, 'Cuarto Trimestre', 11, 'Noviembre', 'Nov', 44, 306, 2, 1, 'Domingo', '2025-11-02'),
(2025, 4, 'Cuarto Trimestre', 11, 'Noviembre', 'Nov', 44, 307, 3, 2, 'Lunes',   '2025-11-03'),
(2025, 4, 'Cuarto Trimestre', 11, 'Noviembre', 'Nov', 44, 308, 4, 3, 'Martes' ,	'2025-11-04'),
(2025, 4, 'Cuarto Trimestre', 11, 'Noviembre', 'Nov', 44, 309, 5, 4, 'Miércoles','2025-11-05'),
(2025, 4, 'Cuarto Trimestre', 11, 'Noviembre', 'Nov', 44, 310, 6, 5, 'Jueves',  	'2025-11-06'),
(2025, 4, 'Cuarto Trimestre', 11, 'Noviembre', 'Nov', 44, 311 ,7 ,6 ,'Viernes','2025-11-07');

ALTER TABLE dim_sede
ALTER COLUMN seq_sk_sede
SET DEFAULT nextval('seq_sk_sede');

INSERT INTO dim_sede (cod_sede, nombre_sede, nombre_ciudad, nombre_pais) VALUES
(101, 'Centro Comercial Parque Cerro Verde', 'Caracas',  'Venezuela'),
(102, 'Centro Comercial La Viña', 'Valencia', 'Venezuela'),
(201, 'Centro Comercial Sambil Chacao', 'Caracas', 'Venezuela'),
(202, 'Centro Comercial Tolón', 'Caracas', 'Venezuela'),
(203, 'Brickell City Centre', 'Brickell', 'Estados Unidos');

ALTER TABLE dim_evento
ALTER COLUMN seq_sk_evento
SET DEFAULT nextval('seq_sk_evento');

INSERT INTO dim_evento (cod_tipo_evento, nb_tipo_evento, cod_evento, nb_evento, descripcion) VALUES
(1, 'Feria', 1001, 'Mamá con Glamour', 'Feria dirigida a madres emprendedoras, marcas premium y experiencias familiares en Cerro Verde'),
(1, 'Feria', 1002, 'Caracas Emprende', 'Evento de networking y exhibición de emprendimientos caraqueños'),
(2, 'Exposición', 1003, 'Expo Diseño CCS','Exposición de diseño gráfico, industrial y moda emergente en Caracas'),
(3, 'Gastronómico', 1004, 'Caracas Food Fest', 'Festival gastronómico con food trucks, chefs invitados y experiencias culinarias'),
(4, 'Tecnología', 1005, 'Tech Summit Caracas', 'Evento de innovación, startups, inteligencia artificial y transformación digital'),
(5, 'Moda', 1006, 'Venezuela Fashion Experience', 'Pasarelas, marcas de moda nacional y diseñadores independientes'),
(1, 'Feria',  2001, 'Expo Valencia Empresarial', 'Feria comercial orientada a pymes y empresas de la región central'),
(3, 'Gastronómico', 2002, 'Sabores de Miami', 'Evento gastronómico internacional con chefs latinoamericanos');

ALTER TABLE dim_cliente
ALTER COLUMN seq_sk_cliente
SET DEFAULT nextval('seq_sk_cliente');

INSERT INTO dim_cliente (cod_cliente, ci_rif,nb_cliente, telefono, direccion, email) VALUES
(9001, 'J-30123456-7', 'Zara C.A.',                '0414-1111111', 'Caracas, Chacao',        'contacto@zara.com'),
(9002, 'J-30987654-1', 'Bershka S.A.',             '0414-2222222', 'Caracas, El Rosal',      'ventas@bershka.com'),
(9003, 'V-18345678',   'Stradivarius',             '0414-3333333', 'Caracas, La Urbina',     'admin@stradivarius.com'),
(9004, 'V-21456789',   'Mac Store Caracas C.A.',   '0414-4444444', 'Valencia, Prebo',        'info@macstoreccs.com'),
(9005, 'J-29777111-9', 'Sephora',                  '0414-5555555', 'Valencia, Centro',       'contacto@sephora.com'),
(9006, 'J-41234567-2', 'Burger Shack CCS',          '0414-7777777', 'Caracas, Altamira',      'ventas@burgershack.com'),
(9007, 'J-42345678-3', 'Sushi Market Venezuela',    '0414-8888888', 'Caracas, Los Palos G.',  'info@sushimarket.com'),
(9008, 'J-43456789-4', 'Panadería La Castellana',   '0414-9999999', 'Caracas, La Castellana', 'admin@panaderialc.com'),
(9009, 'J-44567890-5', 'Café Aroma Andino',         '0414-1010101', 'Caracas, Bello Monte',   'contacto@aromaandino.com'),
(9010, 'J-45678901-6', 'Gold Gym Caracas',           '0414-2020202', 'Caracas, El Rosal',      'info@goldgymccs.com'),
(9011, 'J-46789012-7', 'Fit Studio CCS',             '0414-3030303', 'Caracas, Chacao',        'contacto@fitstudioccs.com'),
(9012, 'J-47890123-8', 'TechNova Solutions C.A.',    '0414-4040404', 'Caracas, La Urbina',     'ventas@technova.com'),
(9013, 'J-48901234-9', 'DataLab Analytics',          '0414-5050505', 'Caracas, Altamira',     'info@datalab.com');

ALTER TABLE dim_visitante
ALTER COLUMN seq_sk_visitante
SET DEFAULT nextval('seq_sk_visitante');

INSERT INTO dim_visitante (
    cod_visitante,
    cedula,
    nb_visiante,
    sexo,
    email
) VALUES
(7001, 12345678, 'Taylor Swift',  'F', 'taylor1989@mail.com'),
(7002, 23456789, 'Niall Horan',   'M', 'nialljameshoran@mail.com'),
(7003, 34567890, 'Zayn Malik',    'M', 'zayn@mail.com'),
(7004, 45678901, 'Louis Tomlinson','M', 'ltomlinson.24@mail.com'),
(7005, 56789012, 'Harry Styles',  'M', 'hstyles@mail.com'),
(7006, 67890123, 'Liam Payne',    'M', 'liampayne@mail.com'),
(7008, 78901234, 'Benson Boone',  'M', 'benson.boone@mail.com');

ALTER TABLE dim_tipo_stand
ALTER COLUMN seq_sk_tipo_stand
SET DEFAULT nextval('seq_sk_tipo_stand');

INSERT INTO dim_tipo_stand (cod_tipo_stand, nb_tipo_stand) VALUES
(1, 'Stand Básico'),
(2, 'Stand Estándar'),
(3, 'Stand Premium'),
(4, 'Stand Gastronómico'),
(5, 'Stand Isla'),
(6, 'Stand Corporativo'),
(7, 'Stand Food Truck');

ALTER TABLE dim_categoria
ALTER COLUMN seq_sk_categoria
SET DEFAULT nextval('seq_sk_categoria');

INSERT INTO dim_categoria (cod_subcategoria, nb_subcategoria, cod_categoria, nb_categoria) VALUES
(101, 'Ropa Femenina',     10, 'Moda'),
(102, 'Ropa Masculina',   10, 'Moda'),
(103, 'Accesorios',       10, 'Moda'),
(104, 'Calzado',          10, 'Moda'),
(201, 'Comida Rápida',     20, 'Gastronomía'),
(202, 'Comida Gourmet',   20, 'Gastronomía'),
(203, 'Café y Postres',   20, 'Gastronomía'),
(204, 'Food Truck',       20, 'Gastronomía'),
(301, 'Electrónica',      30, 'Tecnología'),
(302, 'Software',         30, 'Tecnología'),
(303, 'Accesorios Tech',  30, 'Tecnología'),
(401, 'Cosmética',        40, 'Belleza'),
(402, 'Cuidado Personal', 40, 'Belleza'),
(403, 'Fitness',          40, 'Bienestar'),
(501, 'Servicios Financieros', 50, 'Servicios'),
(502, 'Educación',             50, 'Servicios'),
(503, 'Consultoría',           50, 'Servicios');

ALTER TABLE dim_leyenda
ALTER COLUMN seq_sk_leyenda
SET DEFAULT nextval('seq_sk_leyenda');

-- es esto????
INSERT INTO dim_leyenda(cod_leyenda, nb_leyenda) VALUES
(1, 'Pasillo principal'),
(2, 'Esquina'),
(3, 'Cerca de tarima'),
(4, 'Zona exterior');

-- =========================
-- HECHOS SIN ARREGLAR
-- =========================

-- 10) TH_Alquiler
INSERT INTO th_alquiler
(sk_evento, sk_sede, sk_stand, sk_tipo_stand, sk_categoria_stand, sk_cliente, sk_tiempo,
 mts2_alquilados, monto_alquiler, cantidad_alquilada)
VALUES
(1, 1, 1, 1, 1, 1, 1,  6, 300, 1),
(1, 1, 2, 1, 4, 4, 2,  6, 300, 1),
(1, 1, 3, 2, 1, 1, 3, 12, 700, 1),
(1, 1, 5, 3, 3, 3, 4,  9, 500, 1),
(2, 1, 3, 2, 2, 2, 7, 12, 700, 1),
(2, 1, 4, 2, 2, 2, 8, 12, 700, 1),
(2, 1, 1, 1, 2, 2, 9,  6, 300, 1),
(3, 1, 2, 1, 4, 5, 5,  6, 300, 1),
(3, 1, 5, 3, 3, 3, 6,  9, 500, 1),
(4, 3, 3, 2, 1, 1, 10, 12, 700, 1),
(4, 3, 4, 2, 1, 4, 11, 12, 700, 1),
(4, 3, 5, 3, 3, 3, 12,  9, 500, 1);

-- 11) TH_Visita
INSERT INTO th_visita
(sk_evento, sk_sede, sk_visitante, sk_tiempo, cantidad_visitas, puntuacion, recomendacion)
VALUES
(1, 1, 1, 1, 1, 5, 'Sí'),
(1, 1, 2, 1, 1, 4, 'Sí'),
(1, 1, 3, 2, 1, 5, 'Sí'),
(1, 1, 4, 2, 1, 3, 'No'),
(1, 1, 5, 3, 1, 4, 'Sí'),
(1, 1, 6, 3, 1, 5, 'Sí'),
(2, 1, 1, 7, 1, 4, 'Sí'),
(2, 1, 2, 8, 1, 4, 'Sí'),
(2, 1, 3, 8, 1, 2, 'No'),
(2, 1, 4, 9, 1, 3, 'No'),
(2, 1, 5, 10, 1, 4, 'Sí'),
(3, 1, 6, 5, 1, 5, 'Sí'),
(3, 1, 1, 5, 1, 4, 'Sí'),
(3, 1, 2, 6, 1, 4, 'Sí'),
(3, 1, 3, 6, 1, 3, 'No'),
(4, 3, 4, 10, 1, 5, 'Sí'),
(4, 3, 5, 11, 1, 4, 'Sí'),
(4, 3, 6, 11, 1, 5, 'Sí'),
(4, 3, 1, 12, 1, 4, 'Sí'),
(4, 3, 2, 12, 1, 3, 'No');

-- 12) TH_Meta_Evento
INSERT INTO th_meta_evento
(sk_evento, sk_sede, sk_tiempo, ingresos_esperados, visitantes_esperados, stands_esperados, mts2_esperados)
VALUES
(1, 1, 1,  2500, 300, 5, 45),
(2, 1, 7,  2200, 250, 4, 36),
(3, 1, 5,  1200, 180, 3, 21),
(4, 3, 10, 3000, 400, 6, 60);

-- 13) TH_Ingresos_Evento
INSERT INTO th_ingresos_evento
(sk_evento, sk_sede, sk_tiempo, ingresos_reales, ingresos_esperados, variacion_ingresos)
VALUES
(1, 1, 1,  1800, 2500, -700),
(2, 1, 7,  1700, 2200, -500),
(3, 1, 5,   800, 1200, -400),
(4, 3, 10, 1900, 3000, -1100);



